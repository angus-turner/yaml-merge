#!/usr/bin/env node

'use strict';
const resolve = require('path').resolve;
const fs = require('fs');
const logger = require('winston')
const apiSpecConverter = require('api-spec-converter');
const index = require('../index.js');
const {readAsJSON} = require("../index");

const files = process.argv
    .slice(2)
    .map((path) => resolve(path));


// convert from endpoint
const converted = apiSpecConverter.convert({
    from: 'openapi_3',
    to: 'swagger_2',
    // source: 'http://localhost:8080/v3/api-docs',
    source: files[0]

}).then(function (convertedJson) {
    return index.cleanupOpenAPI(convertedJson)
});

merge(converted, files)

function merge(converted, files) {

    const outputFile = index.yamlMerge(converted, index.readAsJSON(files[1]))

    fs.writeFile('result.yaml', outputFile, function (err) {
        if (err) return console.log(err);
        console.log(`OutputFile ${outputFile}`);
    });
}





